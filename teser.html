<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>n-dimensional cubes</title>
    <style>
        html {
            --border: #87FFDD;
            --control: #87E4FF;
            --controlBackground: #FFFFFF;
            --bg: #000000;
            --fg: #FFFFFF;

            background-color: var(--bg);
            color: var(--fg);
            font-family: sans-serif;
        }

        .slider {
            -webkit-appearance: none;
            -webkit-transition: .2s;
            appearance: none;
            height: 0.75em;
            background: var(--controlBackground);
            outline: none;
            opacity: 0.8;
            transition: opacity .05s;
            display: inline-flex;
            float: right;
            width: 60%;
        }

        .slider:hover {
            opacity: 1;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 1.25em;
            height: 1.25em;
            background: var(--control);
            transition: background-color 0.05s;
            border-width: 0px;
            cursor: pointer;
            outline: none;
        }

        .slider::-moz-range-thumb {
            width: 1.5em;
            height: 1.5em;
            background: var(--control);
            transition: background-color 0.05s;
            cursor: pointer;
            outline: none;
        }

        .slider::-moz-range-thumb:hover {
            background: #ffffff;
        }

        .control {
            padding-bottom: 1em;
            font-weight: bolder;
            border: 0%;
        }

        #panel {
            border-style: solid;
            border-width: 0.25em;
            border-color: var(--border);
            box-sizing: border-box;
            padding: 0.5em;
            display: inline-block;
            float: right;
        }

        #c {
            border-style: solid;
            border-width: 0.25em;
            border-color: var(--border);
            box-sizing: border-box;
            display: inline-block;
            float: left;

        }
    </style>
</head>

<body>

    <canvas id="c" width="100%" height="100%"></canvas>
    <div id="panel"></div>
    <script>
        // display name, id, min, max, default, step
        function axisname(x, dim) {
            if (dim == 2) {
                return "xy";
            } else {
                let arr = [...Array(dim).keys()];
                let combos = arr.flatMap(e => arr.filter(f => f > e).map(g => [e, g]));
                let c = x;
                let a1 = c % (combos.length - 1);
                c = Math.floor(c / (combos.length - 1));
                let a2 = combos[c % (combos.length - a1 - 1) + a1 + 1];
                a1 = combos[a1];
                let axisString = "xyzwuvtsrqponmlkjihgfedcba";
                return axisString.substr(a1[0], 1) + axisString.substr(a1[1], 1) + "," + axisString.substr(a2[0], 1) + axisString.substr(a2[1], 1);
            }
        }
        let params = {
            'dim': [(v) => "Dimension: " + v, 2, 8, 4, 1],
            'lineWidth': [(v) => "Line width: " + v, 0.01, 4, 1, 0.001],
            'dist': [(v) => "Distance: " + v, 1, 5, 2.5, 0.001],
            'zoom': [(v) => "Zoom: " + v, -5, 5, 1, 0.001],
            'segments': [(v) => "Line segments: " + v, 1, 10, 3, 1],
            'rotSpeed': [(v) => "Rotation speed: " + v, 0, 20, 1, 0.1],
            //'rotAxis': [(v) => "Rotation axis: " + axisname(parseFloat(v), 4), 0, 20, 1, 1]
        }
        let paramValues = {}
        Object.keys(params).forEach(e => paramValues[e] = params[e][3]);
        function upd(id, value, controled) {
            document.getElementById(id + 'Label').innerHTML = params[id][0](value);
            if (!controled) {
                document.getElementById(id).value = value;
            }
            paramValues[id] = parseFloat(value);
        }

        let s = "";
        Object.keys(params).forEach(i => {
            let e = params[i];
            s += '<div class="control"><label id="' + i + 'Label" class="left" for="' + i + '">' + e[0](e[3]) + '</label>';
            s += '<input oninput="upd(' + "'" + i + "'," + 'this.value,true)" id="' + i + '"type="range" min="' + e[1] + '"" max="' + e[2] + '" value="' + e[3] + '" step="' + e[4] + '"class="slider" id="myRange"></div>';
        });
        s += "<p>Drag to rotate, double tap to change axes of rotation.</p>";
        document.querySelector("#panel").innerHTML = s;
    </script>
</body>

<script>
    let c = document.getElementById('c');;
    let x = c.getContext('2d');
    let mrots = [];
    let maxis1 = 0;
    let maxis2 = 1;
    let maxis3 = 2;
    function resize() {
        let dw = document.body.clientWidth || 400;
        let dh = document.documentElement.clientHeight - 20 || 400; // wtf does this -20 come from?
        if (dw > dh) {
            dw = dw * 0.5 - 5;
            document.getElementById("panel").style.height = dh + "px";
            document.getElementById("panel").style.float = "right";
            document.getElementById("c").style.marginBottom = "0px";
        } else {
            dh = dw;
            document.getElementById("panel").style.height = "auto";
            document.getElementById("panel").style.float = "left";
            document.getElementById("c").style.marginBottom = "10px";
        }
        document.getElementById("panel").style.width = dw + "px";
        c.style.width = dw + "px";
        c.style.height = dh + "px";
        c.width = c.clientWidth;
        c.height = c.clientHeight;
    }
    window.onresize = resize;
    resize();
    resize();
    c.onmousemove = c.touchmove = (ev) => {
        if (ev.buttons & 1) {
            upd("rotSpeed", 0);
            if (!mrots[maxis1]) mrots[maxis1] = [];
            if (!mrots[maxis1][maxis3]) mrots[maxis1][maxis3] = 0;
            if (!mrots[maxis2]) mrots[maxis2] = [];
            if (!mrots[maxis2][maxis3]) mrots[maxis2][maxis3] = 0;
            mrots[maxis1][maxis3] += ev.movementX * 3 / c.width;
            mrots[maxis2][maxis3] += ev.movementY * 3 / c.width;
        }
    }
    c.ondblclick = (ev) => {
        maxis1++;
        if (maxis1 >= maxis2) {
            maxis1 = 0;
            maxis2++;
            if (maxis2 >= maxis3) {
                maxis1 = 0;
                maxis2 = 1;
                maxis3++;
            }
        }
        if (maxis3 >= paramValues["dim"]) {
            maxis1 = 0;
            maxis2 = 1;
            maxis3 = 2;
        }
    }
    function u(t) {


        x.clearRect(0, 0, c.width, c.height);
        let scaleDim = Math.sqrt(c.width * c.width + c.height * c.height) / Math.sqrt(2);
        let mdist = paramValues["dist"] * Math.sqrt(paramValues["dim"]);
        let mzoom = 0.001 * (2 ** paramValues["zoom"]) * (8 ** paramValues["dim"]);

        let q = (v, l) => l.map((i) => i.concat([v]))
        let r = (n, l) => n ? r(n - 1, q(-1, l).concat(q(1, l))) : l
        let s = (n, l) => n ? l.map((i) => (i.push(i.shift()), i.slice())).concat(s(n - 1, l)) : []
        let u = (n) => s(n, r(n, [[]]))

        let dd = (l) => l.map((i) => i.map((v) => v / (i[0] + mdist))).map((i) => (i.shift(), i))

        let rot = (l, t, a1, a2) => l.map((i) => i.map((v, j) => (j == a1 ? v * Math.cos(t) + i[a2] * Math.sin(t) : (j == a2 ? v * Math.cos(t) - i[a1] * Math.sin(t) : v))))

        let ps = u(paramValues["dim"]);
        let e = ps[0].length

        let rots = []
        if (paramValues["rotSpeed"]) {
            while (--e) {
                let d = e;
                while (d--) {
                    rots.push([e, d, t * paramValues["rotSpeed"] * 10 / (e * 10 + d)])
                }
            }
        } else {
            mrots.forEach((u, j) => (u.forEach((v, k) => (j < paramValues["dim"] && k < paramValues["dim"]) ? rots.push([j, k, v]) : [])));
        }
        rots.forEach(e => {
            ps = rot(ps, e[2], e[0], e[1]);
        })
        while (ps[0].length > 3)
            ps = dd(ps)
        let widths = []
        if (ps[0].length == 3) {
            widths = ps.map((i) => 10 * paramValues["lineWidth"] / (i[0] + mdist))
            ps = dd(ps)
        } else
            widths = ps.map((i) => paramValues["lineWidth"]);
        let d = ps.map((i) => (i.map((j) => j * 0.5 * mzoom)))


        let i = 0;
        while (d[i]) {
            let ox = c.width / 2;
            let oy = c.height / 2;
            let s = paramValues["segments"];
            let xb = d[i][0] * scaleDim + ox;
            let yb = d[i][1] * scaleDim + oy;
            let wb = widths[i++];
            let xs = d[i][0] * scaleDim + ox - xb;
            let ys = d[i][1] * scaleDim + oy - yb;
            let ws = (widths[i++] - wb);
            x.beginPath()
            x.strokeStyle = 'white'
            x.moveTo(xb, yb);
            while (s--) {
                sc = 1 - (s / paramValues["segments"])
                x.lineWidth = wb + sc * ws;
                x.lineTo(xb + sc * xs, yb + sc * ys)
                x.stroke();

            }
        }

    }
    function l() {

        u((new Date()).getTime() / 1000);
        requestAnimationFrame(l);
    }
    requestAnimationFrame(l);
</script>

</html>